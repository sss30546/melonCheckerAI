#!/usr/bin/env python3
import os
import json
import streamlit as st
from groq import Groq
from dotenv import load_dotenv

# ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡πà‡∏≤ ENV
load_dotenv(".env")
GROQ_API_KEY = os.getenv("GROQ_API_KEY")
client = Groq(api_key=GROQ_API_KEY)

st.set_page_config(page_title="üçã Lemon Disease Analysis Chatbot", page_icon="üçã", layout="wide")

# ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏ä‡∏ï‡∏ö‡∏≠‡∏ï
def chatboot(question):
    system_prompt = """
‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏î‡πâ‡∏≤‡∏ô‡πÇ‡∏£‡∏Ñ‡∏û‡∏∑‡∏ä ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ "‡πÇ‡∏£‡∏Ñ‡πÉ‡∏ô‡πÄ‡∏•‡∏°‡∏≠‡∏ô (Lemon)"  
‡πÇ‡∏õ‡∏£‡∏î‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏•‡∏°‡∏≠‡∏ô‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏£‡∏Ñ‡πÉ‡∏î‡πÉ‡∏ô 3 ‡πÇ‡∏£‡∏Ñ‡∏´‡∏•‡∏±‡∏Å‡∏ô‡∏µ‡πâ  
‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢

**‡πÇ‡∏£‡∏Ñ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡πÑ‡∏î‡πâ:**
1. **‡πÇ‡∏£‡∏Ñ‡πÅ‡∏Ñ‡∏á‡πÄ‡∏Å‡∏≠‡∏£‡πå (Citrus Canker)**  
   - ‡πÉ‡∏ö‡∏≠‡πà‡∏≠‡∏ô‡∏°‡∏µ‡∏à‡∏∏‡∏î‡∏ô‡∏π‡∏ô‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏• ‡∏•‡πâ‡∏≠‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏ß‡∏á‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á 
   - ‡∏ú‡∏•‡∏°‡∏µ‡πÅ‡∏ú‡∏•‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡∏≠‡∏¢‡πà‡∏π‡∏ö‡∏≤‡∏á‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì
   - ‡πÅ‡∏ú‡∏•‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏•‡∏∞‡∏´‡∏¢‡∏≤‡∏ö‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡πÅ‡∏ú‡∏•‡πÄ‡∏ô‡πà‡∏≤ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏ö‡∏à‡∏∞‡∏™‡∏≤‡∏Å‡∏°‡∏∑‡∏≠  
   - ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏: ‡πÅ‡∏ö‡∏Ñ‡∏ó‡∏µ‡πÄ‡∏£‡∏µ‡∏¢ *Xanthomonas citri*  
   - ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£: ‡∏ï‡∏±‡∏î‡∏Å‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏£‡∏Ñ, ‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏£‡∏Ñ‡∏≠‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå, ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ô‡∏ß‡∏Å‡∏±‡∏ô‡∏•‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏£‡πà‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÇ‡∏£‡∏Ñ

2. **‡πÇ‡∏£‡∏Ñ‡∏™‡πÅ‡∏Ñ‡∏ö (Citrus Scab)**  
   - ‡πÉ‡∏ö‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏≠‡πà‡∏≠‡∏ô‡∏°‡∏µ‡∏ï‡∏∏‡πà‡∏°‡∏ô‡∏π‡∏ô‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢‡∏™‡∏∞‡πÄ‡∏Å‡πá‡∏î‡∏ó‡∏±‡πà‡∏ß‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì 
   - ‡πÅ‡∏ú‡∏•‡∏™‡∏µ‡∏Ñ‡∏£‡∏µ‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏≠‡πà‡∏≠‡∏ô ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÉ‡∏ô‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á  
   - ‡∏ú‡∏•‡∏°‡∏µ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏ö‡∏¥‡∏î‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ß
   - ‡πÉ‡∏ö‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡∏≤
   - ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏: ‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏£‡∏≤ *Elsino√´ fawcetti*  
   - ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£: ‡∏û‡πà‡∏ô‡∏™‡∏≤‡∏£‡πÅ‡∏°‡∏ô‡πÇ‡∏Ñ‡πÄ‡∏ã‡∏ö ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏≠‡∏õ‡πÄ‡∏õ‡∏≠‡∏£‡πå

3. **‡πÇ‡∏£‡∏Ñ‡πÅ‡∏≠‡∏ô‡πÅ‡∏ó‡∏£‡∏Ñ‡πÇ‡∏ô‡∏™ (Anthracnose)**  
   - ‡∏ú‡∏•‡πÄ‡∏•‡∏°‡πà‡∏≠‡∏ô‡∏û‡∏ö‡∏à‡∏∏‡∏î‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏î‡∏≥ ‡πÅ‡∏ú‡∏•‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡∏ú‡∏•‡πÅ‡∏´‡πâ‡∏á 
   - ‡∏ú‡∏•‡∏£‡πà‡∏ß‡∏á‡∏á‡πà‡∏≤‡∏¢ 
   - ‡πÉ‡∏ö‡∏£‡πà‡∏ß‡∏á‡∏á‡πà‡∏≤‡∏¢
   - ‡∏ú‡∏•‡∏ú‡∏¥‡∏î‡∏£‡∏π‡∏õ ‡∏£‡∏π‡∏õ‡∏£‡πà‡∏≤‡∏á‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ ‡∏£‡∏π‡∏õ‡∏£‡πà‡∏≤‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô
   - ‡∏Å‡∏¥‡πà‡∏á‡∏Å‡πâ‡∏≤‡∏ô‡πÅ‡∏´‡πâ‡∏á‡∏ï‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏õ‡∏Å‡∏Ñ‡∏•‡∏∏‡∏°‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏ú‡∏á‡∏™‡∏õ‡∏≠‡∏£‡πå‡∏™‡∏µ‡∏î‡∏≥
   - ‡πÉ‡∏ö‡∏£‡πà‡∏ß‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÅ‡∏•‡∏∞‡πÉ‡∏ö‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏õ‡∏Å‡∏Ñ‡∏•‡∏∏‡∏°‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏™‡∏õ‡∏≠‡∏£‡πå‡∏™‡∏µ‡∏î‡∏≥
   - ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏: ‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏£‡∏≤ *Colletotrichum gloeosporioides*  
   - ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£: ‡πÄ‡∏Å‡πá‡∏ö‡∏ú‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏£‡∏Ñ‡∏≠‡∏≠‡∏Å, ‡∏û‡πà‡∏ô‡∏™‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏£‡∏≤

**‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö:**
‡πÉ‡∏´‡πâ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô JSON ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ ‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ô‡∏µ‡πâ:
{
  "disease": "‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏£‡∏Ñ" ‡∏´‡∏£‡∏∑‡∏≠ "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏∞‡∏ö‡∏∏‡πÑ‡∏î‡πâ",
  "‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏": "‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö",
  "‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏û‡∏ö": "‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏Å‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ",
  "‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô": "‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°",
  "reason": "‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå"
}
"""
    response = client.chat.completions.create(
        model="llama-3.1-8b-instant",
        messages=[
            {"role": "system", "content": system_prompt},
            {"role": "user", "content": question},
        ],
        temperature=0.3,
        max_tokens=1024,
    )
    return response.choices[0].message.content.strip()


# ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
def main():
    st.markdown("""
        <style>
        /* ‡∏à‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏Å‡∏Ç‡∏≠‡∏ö */
        .chat-bubble {
            background-color: #f0f2f6;
            padding: 12px 18px;
            border-radius: 12px;
            margin-bottom: 10px;
            word-wrap: break-word;
            white-space: pre-wrap;
            font-size: 16px;
            line-height: 1.5;
        }
        .chat-user {
            background-color: #dcf7da;
        }
        .chat-bot {
            background-color: #f7eeda;
        }
        .stTextInput > div > div > input {
            font-size: 16px !important;
        }
        </style>
    """, unsafe_allow_html=True)

    st.title("üçã Lemon Disease Analysis Chatbot")
    st.subheader("‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡∏°‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ß‡πà‡∏≤‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏£‡∏Ñ‡∏≠‡∏∞‡πÑ‡∏£")

    if "messages" not in st.session_state:
        st.session_state["messages"] = [
            {"role": "assistant", "content": (
                "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏à‡πâ‡∏≤ üçã ‡∏â‡∏±‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡πâ‡∏≠‡∏á‡∏™‡∏ï‡∏≤‡∏á‡∏Ñ‡πå ‡∏â‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ä‡∏ï‡∏ö‡∏≠‡∏ï‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏£‡∏Ñ‡πÉ‡∏ô‡πÄ‡∏•‡∏°‡∏≠‡∏ô\n"
                "‡∏â‡∏±‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 3 ‡πÇ‡∏£‡∏Ñ ‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πà Citrus canker, Citrus scab, Anthracnose \n\n"
                "‡πÇ‡∏õ‡∏£‡∏î‡∏ö‡∏≠‡∏Å‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡∏°‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 3 ‡∏î‡πâ‡∏≤‡∏ô ‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πà ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏Ç‡∏≠‡∏á‡∏ú‡∏• ‡πÉ‡∏ö ‡πÅ‡∏•‡∏∞‡∏Å‡∏¥‡πà‡∏á/‡∏¢‡∏≠‡∏î ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏±‡∏ô‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î \n"
                "‚ö†Ô∏è ‡πÇ‡∏õ‡∏£‡∏î‡∏ö‡∏≠‡∏Å‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ ‡πÄ‡∏ä‡πà‡∏ô:\n"
                "- ‡πÉ‡∏ö‡∏°‡∏µ‡πÅ‡∏ú‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÄ‡∏Ç‡πâ‡∏° ‡πÅ‡∏ú‡∏•‡∏ô‡∏π‡∏ô‡∏£‡∏≠‡∏ö‡πÅ‡∏ú‡∏•‡∏°‡∏µ‡∏Ç‡∏≠‡∏ö‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á ‡πÉ‡∏ö‡∏ö‡∏≤‡∏á‡πÉ‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏£‡πà‡∏ß‡∏á ‡∏ú‡∏•‡∏°‡∏µ‡∏à‡∏∏‡∏î‡πÅ‡∏ú‡∏•‡∏ô‡∏π‡∏ô‡πÅ‡∏Ç‡πá‡∏á‡∏´‡∏•‡∏≤‡∏¢‡∏à‡∏∏‡∏î‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏°  ‡∏Å‡∏¥‡πà‡∏á‡∏≠‡πà‡∏≠‡∏ô‡∏°‡∏µ‡πÅ‡∏ú‡∏•‡πÄ‡∏•‡πá‡∏Å ‡πÜ ‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢\n"
                "- ‡∏ú‡∏¥‡∏ß‡∏°‡∏µ‡πÅ‡∏ú‡∏•‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏∞‡πÄ‡∏Å‡πá‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏ß‡πâ‡∏≤‡∏á ‡πÉ‡∏ö‡∏°‡∏µ‡∏à‡∏∏‡∏î‡∏ô‡∏π‡∏ô‡πÄ‡∏•‡πá‡∏Å‡πÜ ‡πÉ‡∏ö‡πÅ‡∏Ç‡πá‡∏á‡∏°‡∏≤‡∏Å ‡∏ú‡∏•‡πÄ‡∏•‡∏°‡πà‡∏≠‡∏ô‡∏ú‡∏¥‡∏î‡∏£‡∏π‡∏õ\n"
                "- ‡πÉ‡∏ö‡∏°‡∏µ‡∏à‡∏∏‡∏î‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÄ‡∏Ç‡πâ‡∏°‡∏ó‡∏±‡πà‡∏ß‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì ‡∏ú‡∏•‡∏°‡∏µ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏ô‡πà‡∏≤‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡∏∞‡∏£‡∏π‡∏õ‡∏£‡πà‡∏≤‡∏á‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥\n\n"
                "‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ö‡∏≠‡∏Å‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏â‡∏±‡∏ô‡∏ó‡∏£‡∏≤‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏´‡πâ‡∏ú‡πâ‡∏π‡πÉ‡∏ä‡πâ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° üöÄ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏â‡∏±‡∏ô‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‚ùóÔ∏è"
            )}
        ]

    with st.form("chat_form"):
        query = st.text_input("üó£Ô∏è ‡∏Ñ‡∏∏‡∏ì:", placeholder="‡πÄ‡∏ä‡πà‡∏ô '‡πÉ‡∏ö‡∏°‡∏µ‡∏à‡∏∏‡∏î‡∏ô‡∏π‡∏ô‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏• ‡∏Ç‡∏≠‡∏ö‡πÉ‡∏ö‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏£‡∏≠‡∏ö‡πÜ‡πÅ‡∏ú‡∏• ‡∏ú‡∏•‡∏°‡∏µ‡πÅ‡∏ú‡∏•‡πÄ‡∏ô‡πà‡∏≤'").strip()
        submitted = st.form_submit_button("üöÄ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°")

        if submitted and query:
            answer = chatboot(query)
            st.session_state["messages"].append({"role": "user", "content": query})
            st.session_state["messages"].append({"role": "assistant", "content": answer})
        elif submitted and not query:
            st.warning("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á")

    # ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏ï‡πâ‡∏ï‡∏≠‡∏ö‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°
    for msg in st.session_state["messages"]:
        if msg["role"] == "user":
            st.markdown(f"<div class='chat-bubble chat-user'><b>üßë‚Äçüåæ ‡∏Ñ‡∏∏‡∏ì:</b> {msg['content']}</div>", unsafe_allow_html=True)
        else:
            try:
                data = json.loads(msg["content"])
                html = f"""
                <div class='chat-bubble chat-bot'>
                    <b>ü§ñ ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:</b><br>
                    <b>‡πÇ‡∏£‡∏Ñ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ:</b> {data.get("disease", "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏")}<br>
                    <b>‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:</b> {data.get("‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏", "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏")}<br>
                    <b>‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏û‡∏ö:</b> {data.get("‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏û‡∏ö", "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏")}<br>
                    <b>‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô:</b> {data.get("‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô", "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏")}<br>
                    <b>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•:</b> {data.get("reason", "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏")}
                </div>
                """
                st.markdown(html, unsafe_allow_html=True)
            except Exception:
                st.markdown(f"<div class='chat-bubble chat-bot'><b>ü§ñ ‡∏ô‡πâ‡∏≠‡∏á‡∏™‡∏ï‡∏≤‡∏á‡∏Ñ‡πå:</b> {msg['content']}</div>", unsafe_allow_html=True)

    st.markdown("---")
    st.caption("üå± ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢‡∏ó‡∏µ‡∏° Future Lab ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏ï‡∏£‡∏µ‡∏®‡∏£‡∏µ‡∏ô‡πà‡∏≤‡∏ô | üçã ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ä‡∏ï‡∏ö‡∏≠‡∏ï‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏£‡∏Ñ‡πÉ‡∏ô‡πÄ‡∏•‡∏°‡∏≠‡∏ô‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô (Lemon Disease Analysis Chatbot) - version : 1.3.6")

if __name__ == "__main__":
    main()
